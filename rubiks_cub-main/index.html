<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>Rubik's Cube</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <link rel="stylesheet" href="style.css">
    
    <!-- Force background change -->
    <style>
        html, body {
            background: linear-gradient(135deg, #0a0e27 0%, #1a1f3a 25%, #2d3a5f 50%, #1e3a8a 75%, #0f172a 100%) !important;
            background-attachment: fixed !important;
            min-height: 100vh !important;
        }
    </style>
    
    <style>
      @import url('https://fonts.googleapis.com/css2?family=Open+Sans&display=swap');
      
      /* Success Modal Styles */
      .success-modal {
        display: none;
        position: fixed;
        z-index: 1000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0,0,0,0.7);
        animation: fadeIn 0.3s ease-in;
      }
      
      .success-content {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        margin: 15% auto;
        padding: 40px;
        border-radius: 20px;
        width: 80%;
        max-width: 500px;
        text-align: center;
        color: white;
        box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        animation: slideIn 0.5s ease-out;
      }
      
      .success-content h2 {
        font-size: 2.5em;
        margin-bottom: 20px;
        text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
      }
      
      .success-content p {
        font-size: 1.2em;
        margin-bottom: 30px;
      }
      
      .success-btn {
        background: linear-gradient(45deg, #ff6b6b, #ee5a24);
        border: none;
        color: white;
        padding: 12px 30px;
        font-size: 1.1em;
        border-radius: 25px;
        cursor: pointer;
        transition: transform 0.2s;
        margin: 0 10px;
      }
      
      .success-btn:hover {
        transform: scale(1.05);
      }
      
      /* Reward Modal Styles */
      .reward-modal {
        display: none;
        position: fixed;
        z-index: 1001;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
        animation: fadeIn 0.5s ease-in;
      }
      
      .reward-content {
        position: relative;
        width: 100%;
        height: 100%;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        color: white;
        text-align: center;
      }
      
      .reward-title {
        font-size: 3em;
        margin-bottom: 20px;
        text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        animation: glow 2s ease-in-out infinite alternate;
      }
      
      @keyframes glow {
        from { text-shadow: 2px 2px 4px rgba(0,0,0,0.5); }
        to { text-shadow: 0 0 20px #fff, 0 0 30px #fff, 0 0 40px #fff; }
      }
      
      .engine-canvas {
        width: 400px;
        height: 300px;
        margin: 20px 0;
        border-radius: 15px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.3);
      }
      
      .cockpit-canvas {
        width: 400px;
        height: 300px;
        margin: 20px 0;
        border-radius: 15px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.3);
      }
      
      .wing-canvas {
        width: 400px;
        height: 300px;
        margin: 20px 0;
        border-radius: 15px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.3);
      }
      
      .fuselage-canvas {
        width: 400px;
        height: 300px;
        margin: 20px 0;
        border-radius: 15px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.3);
      }
      
      .reward-text {
        font-size: 1.5em;
        margin: 20px 0;
        text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
      }
      
      .next-level-btn {
        background: linear-gradient(45deg, #28a745, #20c997);
        border: none;
        color: white;
        padding: 15px 40px;
        font-size: 1.3em;
        border-radius: 30px;
        cursor: pointer;
        transition: all 0.3s ease;
        margin-top: 20px;
        box-shadow: 0 5px 15px rgba(40, 167, 69, 0.4);
      }
      
      .next-level-btn:hover {
        transform: translateY(-3px);
        box-shadow: 0 8px 25px rgba(40, 167, 69, 0.6);
      }
      
      /* Failure Modal Styles */
      .failure-modal {
        display: none;
        position: fixed;
        z-index: 1000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0,0,0,0.7);
        animation: fadeIn 0.3s ease-in;
      }
      
      .failure-content {
        background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
        margin: 15% auto;
        padding: 40px;
        border-radius: 20px;
        width: 80%;
        max-width: 500px;
        text-align: center;
        color: white;
        box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        animation: slideIn 0.5s ease-out;
      }
      
      .failure-content h2 {
        font-size: 2.5em;
        margin-bottom: 20px;
        text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
      }
      
      .failure-content p {
        font-size: 1.2em;
        margin-bottom: 30px;
      }
      
      .failure-btn {
        background: linear-gradient(45deg, #667eea, #764ba2);
        border: none;
        color: white;
        padding: 12px 30px;
        font-size: 1.1em;
        border-radius: 25px;
        cursor: pointer;
        transition: transform 0.2s;
      }
      
      .failure-btn:hover {
        transform: scale(1.05);
      }
      
      @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
      }
      
      @keyframes slideIn {
        from { transform: translateY(-50px); opacity: 0; }
        to { transform: translateY(0); opacity: 1; }
      }
      
      /* Level buttons styling */
      .btn-level1 {
        background: linear-gradient(45deg, #667eea, #764ba2);
        border: none;
        color: white;
        font-weight: bold;
        text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
      }
      
      .btn-level1:hover {
        background: linear-gradient(45deg, #5a6fd8, #6a4190);
        color: white;
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0,0,0,0.2);
      }
      
      .btn-level1:disabled {
        background: #6c757d;
        transform: none;
        box-shadow: none;
      }
      
      .btn-level2 {
        background: linear-gradient(45deg, #ff6b6b, #ee5a24);
        border: none;
        color: white;
        font-weight: bold;
        text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
      }
      
      .btn-level2:hover {
        background: linear-gradient(45deg, #ff5252, #ff7043);
        color: white;
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0,0,0,0.2);
      }
      
      .btn-level2:disabled {
        background: #6c757d;
        transform: none;
        box-shadow: none;
      }
      
      .btn-level3 {
        background: linear-gradient(45deg, #ffd700, #ff8c00);
        border: none;
        color: white;
        font-weight: bold;
        text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
      }
      
      .btn-level3:hover {
        background: linear-gradient(45deg, #ffed4e, #ffa726);
        color: white;
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0,0,0,0.2);
      }
      
      .btn-level3:disabled {
        background: #6c757d;
        transform: none;
        box-shadow: none;
      }
      
      .btn-level4 {
        background: linear-gradient(45deg, #9b59b6, #8e44ad);
        border: none;
        color: white;
        font-weight: bold;
        text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
      }
      
      .btn-level4:hover {
        background: linear-gradient(45deg, #8e44ad, #7d3c98);
        color: white;
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0,0,0,0.2);
      }
      
      .btn-level4:disabled {
        background: #6c757d;
        transform: none;
        box-shadow: none;
      }
      
      .btn-level5 {
        background: linear-gradient(45deg, #e74c3c, #c0392b);
        border: none;
        color: white;
        font-weight: bold;
        text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
      }
      
      .btn-level5:hover {
        background: linear-gradient(45deg, #c0392b, #a93226);
        color: white;
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0,0,0,0.2);
      }
      
      .btn-level5:disabled {
        background: #6c757d;
        transform: none;
        box-shadow: none;
      }
      
      /* Done button styling */
      .btn-done {
        background: linear-gradient(45deg, #28a745, #20c997);
        border: none;
        color: white;
        font-weight: bold;
        text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
        transition: all 0.3s ease;
        box-shadow: 0 2px 8px rgba(40, 167, 69, 0.3);
      }
      
      .btn-done:hover {
        background: linear-gradient(45deg, #218838, #1ea085);
        color: white;
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(40, 167, 69, 0.4);
      }
      
      .btn-done:disabled {
        background: #6c757d;
        transform: none;
        box-shadow: none;
        cursor: not-allowed;
      }
    </style>
  </head>
  <body>
    <div id="info-container">
      <h2>Key Bindings</h2>
      <ul>
        <li>Front: 'F' / Back: 'B'</li>
        <li>Left: 'L' / Right: 'R'</li>
        <li>Up: 'U' / Down: 'D'</li>
        <li>Middle: 'M'</li>
        <li>Forward: '1' / Reverse: '2'</li>
      </ul>
      <button class="btn btn-info" id="undo-button" onclick="undoLastMove()" data-toggle="tooltip" data-placement="right" title="Undo last move">
        <img src="assets/undo_icon.png" alt="Undo" width="16px">
      </button>
      <button class="btn btn-success" id="solve-button" onclick="handleSolve()" data-toggle="tooltip" data-placement="right" title="Solve the cube">Solve</button>
      <button class="btn btn-warning" id="scramble-button" onclick="scrambleCube()" data-toggle="tooltip" data-placement="right" title="Scramble the cube">Scramble</button>
      <button class="btn btn-done" id="done-button" onclick="checkIfSolved()" data-toggle="tooltip" data-placement="right" title="Check if solved">Done</button>
      <button class="btn btn-info" id="reset-button" onclick="resetState()" data-toggle="tooltip" data-placement="right" title="Start over">Reset</button>
    </div>
    
    <!-- New vertical level buttons container -->
    <div id="level-button-group">
      <button class="btn btn-level1" id="level1-button" onclick="scrambleCubeLevel1()" data-toggle="tooltip" data-placement="right" title="Level 1 - 3 moves">Level 1 - Scramble</button>
      <button class="btn btn-level2" id="level2-button" onclick="scrambleCubeLevel2()" data-toggle="tooltip" data-placement="right" title="Level 2 - 4 moves">Level 2 - Scramble</button>
      <button class="btn btn-level3" id="level3-button" onclick="scrambleCubeLevel3()" data-toggle="tooltip" data-placement="right" title="Level 3 - 5 moves">Level 3 - Scramble</button>
      <button class="btn btn-level4" id="level4-button" onclick="scrambleCubeLevel4()" data-toggle="tooltip" data-placement="right" title="Level 4 - 7 moves">Level 4 - Scramble</button>
      <button class="btn btn-level5" id="level5-button" onclick="scrambleCubeLevel5()" data-toggle="tooltip" data-placement="right" title="Level 5 - 10 moves">Level 5 - Scramble</button>
    </div>
    
    <!-- Cheat Code Section -->
    <div id="cheat-container">
      <h3>🔓 Cheat Code</h3>
      <div class="cheat-input-group">
        <input type="text" id="cheat-input" placeholder="Enter cheat code..." maxlength="10" class="cheat-input">
        <button class="btn btn-cheat" id="cheat-button" onclick="activateCheatCode()" data-toggle="tooltip" data-placement="right" title="Activate cheat code">Activate</button>
      </div>
      <div id="cheat-message" class="cheat-message"></div>
    </div>
    <div id="action-display"></div>
    <div id="solution-display"></div>
    <div id="direction-container">
      <button id="clockwise-icon" style="display: block;" type="button" class="btn btn-info" onclick="setReverse();">
        <img src="assets/clockwise_icon.png" alt="Clockwise" data-toggle="tooltip" data-placement="right" title="Change to counter-clockwise" width="32px">
      </button>
      <button id="counter-clockwise-icon" style="display: none;" type="button" class="btn btn-info" onclick="setReverse();">
        <img src="assets/counter-clockwise_icon.png" alt="Counter-Clockwise" data-toggle="tooltip" data-placement="right" title="Change to clockwise" width="32px">
      </button>
    </div>
    <div id="canvas"></div>
    
    <div id="messages-container"></div>
    
    <!-- Success Modal -->
    <div id="successModal" class="success-modal">
      <div class="success-content">
        <h2 id="successTitle"> Congratulations!</h2>
        <p id="successMessage">You've successfully solved the level!</p>
        <button class="success-btn" onclick="collectReward()">Collect Reward</button>
        <button class="success-btn" onclick="retryCube()">Retry</button>
      </div>
    </div>
    
    <!-- Dark Overlay for Reward Screen -->
    <div id="rewardOverlay" class="reward-overlay" style="display: none;"></div>
    
    <!-- Reward Modal -->
    <div id="rewardModal" class="reward-modal">
      <div class="reward-content">
        <h1 class="reward-title" id="rewardTitle"> Level Complete!</h1>
        
        <!-- Single reward image container - only one will be shown at a time -->
        <div id="rewardImageContainer" style="display: flex; justify-content: center; align-items: center; margin: 15px 0;">
          <!-- Level 1: Engine -->
          <img id="level1RewardImage" class="reward-image" style="display: none; width: 300px; height: auto; object-fit: contain;" src="assets/engine.png" alt="Level 1 Reward - Engine">
          
          <!-- Level 2: Cockpit -->
          <img id="level2RewardImage" class="reward-image" style="display: none; width: 300px; height: auto; object-fit: contain;" src="assets/cockpit.png" alt="Level 2 Reward - Cockpit">
          
          <!-- Level 3+: 3D Canvas elements -->
          <canvas id="engineCanvas" class="engine-canvas" style="display: none;"></canvas>
          <canvas id="cockpitCanvas" class="cockpit-canvas" style="display: none;"></canvas>
          <canvas id="wingCanvas" class="wing-canvas" style="display: none;"></canvas>
          <canvas id="fuselageCanvas" class="fuselage-canvas" style="display: none;"></canvas>
        </div>
        
        <div class="reward-text" id="rewardText">✈️ Part Unlocked!</div>
        <button class="next-level-btn" id="nextLevelBtn" onclick="proceedToNextLevel()">Proceed to Next Level</button>
      </div>
    </div>
    
    <!-- Failure Modal -->
    <div id="failureModal" class="failure-modal">
      <div class="failure-content">
        <h2>❌ Not Solved Yet</h2>
        <p>Keep trying! The cube needs to be completely solved.</p>
        <button class="failure-btn" onclick="closeFailureModal()">Continue</button>
      </div>
    </div>
    
    <script src="js/three.min.js"></script>
    <script src="js/OBJLoader.js"></script>
    <script src="js/SourceLoader.js"></script>
    <script src="js/OrbitControls.js"></script>
    <script src="js/KeyboardState.js"></script> <!-- By Jerome Etienne: http://jetienne.com/ -->

    <script type="module" src="modules/main.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
    
    <!-- Solve Detection and Reward Script -->
    <script>
    // Valid moves for scrambling
    const VALID_MOVES = ["R", "R'", "L", "L'", "U", "U'", "D", "D'", "F", "F'", "B", "B'"];
    let isScrambling = false;
    let currentLevel = 0; // 0 = no level, 1 = level 1, 2 = level 2, etc.
    let isSolved = false;
    let rewardUnlocked = false;
    
    // Cheat code variables
    const CHEAT_CODE_LEVEL1 = "COLLINS1";
    const CHEAT_CODE_LEVEL2 = "COLLINS2";
    const CHEAT_CODE_LEVEL3 = "COLLINS3";
    const CHEAT_CODE_LEVEL4 = "COLLINS4";
    const CHEAT_CODE_LEVEL5 = "COLLINS5";
    let cheatCodeUsedLevel1 = false;
    let cheatCodeUsedLevel2 = false;
    let cheatCodeUsedLevel3 = false;
    let cheatCodeUsedLevel4 = false;
    let cheatCodeUsedLevel5 = false;
    
    // Animation variables
    let engineScene, engineCamera, engineRenderer, engineTurbine, engineBody;
    let cockpitScene, cockpitCamera, cockpitRenderer, cockpitDome, cockpitBody, radarAntenna;
    let wingScene, wingCamera, wingRenderer, wingMain, wingFlap, wingLight;
    let fuselageScene, fuselageCamera, fuselageRenderer, fuselageBody, fuselageNose, fuselageTail;
    let animationId;

    // Level configuration
    const LEVEL_CONFIG = {
        1: {
            moves: 3,
            title: "Level 1",
            successMessage: "You've successfully solved Level 1!",
            rewardTitle: "🎉 Level 1 Complete!",
            rewardText: "✈️ Engine Part Unlocked!",
            nextLevelText: "Proceed to Level 2",
            nextLevel: 2,
            rewardType: "engine"
        },
        2: {
            moves: 4,
            title: "Level 2",
            successMessage: "You've successfully completed Level 2!",
            rewardTitle: "🎉 Level 2 Complete!",
            rewardText: "🧠 Cockpit Unlocked! You're ready to pilot.",
            nextLevelText: "Proceed to Level 3",
            nextLevel: 3,
            rewardType: "cockpit"
        },
        3: {
            moves: 5,
            title: "Level 3: Intermediate Challenge",
            successMessage: "🎉 Congratulations! You've successfully completed Level 3!",
            rewardTitle: "🎉 Level 3 Complete!",
            rewardText: "🚀 Wings Unlocked! You're ready for advanced challenges!",
            nextLevelText: "Proceed to Level 4",
            nextLevel: 4,
            rewardType: "wings"
        },
        4: {
            moves: 7,
            title: "Level 4: Advanced Challenge",
            successMessage: "🎉 Congratulations! You've successfully completed Level 4!",
            rewardTitle: "🎉 Level 4 Complete!",
            rewardText: "✈️ Aeroplane Body Unlocked!",
            nextLevelText: "Proceed to Level 5",
            nextLevel: 5,
            rewardType: "fuselage"
        },
        5: {
            moves: 10,
            title: "Level 5: Pro Challenge",
            successMessage: "🎉 Congratulations! You've successfully completed Level 5!",
            rewardTitle: "🎉 Level 5 Complete!",
            rewardText: "🏆 Master Pilot Certificate Unlocked!",
            nextLevelText: "Proceed to Level 6",
            nextLevel: 6,
            rewardType: "master_pilot"
        }
    };

    // Generate a random move
    function getRandomMove() {
        return VALID_MOVES[Math.floor(Math.random() * VALID_MOVES.length)];
    }

    // Generate a scramble sequence for any level
    function generateScrambleSequence(level) {
        const config = LEVEL_CONFIG[level];
        if (!config) {
            console.error(`Level ${level} not configured`);
            return [];
        }
        
        const sequence = [];
        let lastMove = '';
        
        for (let i = 0; i < config.moves; i++) {
            let move;
            do {
                move = getRandomMove();
            } while (
                move === lastMove ||
                (move.charAt(0) === lastMove.charAt(0) && move !== lastMove)
            );
            
            sequence.push(move);
            lastMove = move;
        }
        
        return sequence;
    }

    // Simple solve detection - always return true for now (for testing)
    function checkIfSolvedSimple() {
        console.log("Simple solve detection called");
        
        // For now, let's just check if the user has made any moves
        // This is a temporary solution to test the UI
        const historyString = sessionStorage.getItem("keyEventHistory");
        const history = historyString ? JSON.parse(historyString) : [];
        
        console.log("Move history length:", history.length);
        
        // If the user has made some moves, consider it potentially solved
        // This is just for testing - in reality you'd check the actual cube state
        if (history.length > 0) {
            console.log("User has made moves - considering as potentially solved for testing");
            return true;
        }
        
        console.log("No moves made - not solved");
        return false;
    }

    // Main solve check function
    async function checkIfSolved() {
        console.log("Done button clicked - checking if cube is solved...");
        
        // Disable the Done button temporarily
        const doneButton = document.getElementById("done-button");
        doneButton.disabled = true;
        doneButton.textContent = "Checking...";
        
        try {
            // Use simple solve detection for now
            const solved = checkIfSolvedSimple();
            
            if (solved) {
                console.log("🎉 Cube is solved!");
                showSuccessMessage();
                isSolved = true;
            } else {
                console.log("❌ Cube is not solved yet");
                showFailureMessage();
            }
        } catch (error) {
            console.error("Error checking solve state:", error);
            showFailureMessage();
        } finally {
            // Re-enable the Done button
            doneButton.disabled = false;
            doneButton.textContent = "Done";
        }
    }

    // Show success message with level-specific content
    function showSuccessMessage() {
        const modal = document.getElementById("successModal");
        const title = document.getElementById("successTitle");
        const message = document.getElementById("successMessage");
        
        // Set level-specific content
        if (currentLevel > 0 && LEVEL_CONFIG[currentLevel]) {
            const config = LEVEL_CONFIG[currentLevel];
            title.textContent = `🎉 Congratulations!`;
            message.textContent = config.successMessage;
        } else {
            title.textContent = "🎉 Congratulations!";
            message.textContent = "You've successfully solved the cube!";
        }
        
        modal.style.display = "block";
        
        // Disable further input
        disableAllInputs(true);
        
        console.log("Success message displayed for level", currentLevel);
    }

    // Show failure message
    function showFailureMessage() {
        const modal = document.getElementById("failureModal");
        modal.style.display = "block";
        
        console.log("Failure message displayed");
    }

    // Close success modal
    function closeSuccessModal() {
        const modal = document.getElementById("successModal");
        modal.style.display = "none";
        
        // Re-enable inputs
        disableAllInputs(false);
    }

    // Close failure modal
    function closeFailureModal() {
        const modal = document.getElementById("failureModal");
        modal.style.display = "none";
    }

    // CRITICAL: Function to completely clear the main scene of any 3D models
    function clearMainSceneOf3DModels() {
        try {
            // Get the main scene from sceneManager
            const mainScene = window.scene || document.querySelector('#canvas')?.__scene;
            if (mainScene && mainScene.children) {
                console.log("Clearing main scene of 3D models...");
                
                // Remove any objects that might be 3D models (not the cube, camera, lights, axes)
                const objectsToRemove = [];
                mainScene.children.forEach(child => {
                    // Keep essential objects (cube, camera, lights, axes)
                    if (child.type === 'PerspectiveCamera' || 
                        child.type === 'PointLight' || 
                        child.type === 'AmbientLight' || 
                        child.type === 'AxesHelper' ||
                        child.name === 'cube' ||
                        child.name === 'cubelet') {
                        // Keep these objects
                        return;
                    }
                    
                    // Remove any other objects that might be 3D models
                    if (child.name && (
                        child.name.includes('engine') || 
                        child.name.includes('cockpit') || 
                        child.name.includes('wing') || 
                        child.name.includes('fuselage') ||
                        child.name.includes('reward') ||
                        child.name.includes('airplane') ||
                        child.name.includes('aerospace')
                    )) {
                        objectsToRemove.push(child);
                        console.log("Removing 3D model:", child.name);
                    }
                    
                    // Also remove any objects without names that might be 3D models
                    if (!child.name && child.type === 'Mesh' && child !== mainScene.children.find(c => c.name === 'cube')) {
                        objectsToRemove.push(child);
                        console.log("Removing unnamed 3D model:", child.type);
                    }
                });
                
                // Remove the identified objects
                objectsToRemove.forEach(obj => {
                    mainScene.remove(obj);
                    console.log("Removed 3D model from main scene");
                });
            }
        } catch (error) {
            console.log("Error clearing main scene:", error);
        }
    }
    
    // Helper function to hide all rewards - COMPLETE RESET
    function hideAllRewards() {
        // Hide all canvas elements
        document.getElementById('engineCanvas').style.display = 'none';
        document.getElementById('cockpitCanvas').style.display = 'none';
        document.getElementById('wingCanvas').style.display = 'none';
        document.getElementById('fuselageCanvas').style.display = 'none';
        
        // Hide all image elements
        document.getElementById('level1RewardImage').style.display = 'none';
        document.getElementById('level2RewardImage').style.display = 'none';
        
        // Stop any running animations
        if (animationId) {
            cancelAnimationFrame(animationId);
            animationId = null;
        }
        
        // Clear any 3D scenes that might be running
        if (engineScene) {
            engineScene.clear();
        }
        if (cockpitScene) {
            cockpitScene.clear();
        }
        if (wingScene) {
            wingScene.clear();
        }
        if (fuselageScene) {
            fuselageScene.clear();
        }
        
        // Reset all 3D scene variables
        engineScene = null;
        cockpitScene = null;
        wingScene = null;
        fuselageScene = null;
        
        // CRITICAL: Clear the main scene of any 3D models
        clearMainSceneOf3DModels();
        
        // Clear any 3D objects that might be in the main scene
        const mainCanvas = document.getElementById("canvas");
        if (mainCanvas) {
            // Force a complete reset of the main scene
            mainCanvas.style.opacity = "0";
        }
    }
    
    // Collect reward - show appropriate animation
    function collectReward() {
        console.log("Collecting reward for level", currentLevel);
        
        // Hide success modal
        const successModal = document.getElementById("successModal");
        successModal.style.display = "none";
        
        // Show dark overlay and hide cube
        showRewardScreen();
        
        // Show reward modal
        const rewardModal = document.getElementById("rewardModal");
        rewardModal.style.display = "flex";
        
        // COMPLETE RESET - Hide ALL rewards first
        hideAllRewards();
        
        // Clear the reward content completely
        const rewardContent = document.querySelector('.reward-content');
        if (rewardContent) {
            // Keep the structure but clear any dynamic content
            const title = document.getElementById("rewardTitle");
            const text = document.getElementById("rewardText");
            const nextBtn = document.getElementById("nextLevelBtn");
            
            // Reset to default state
            title.textContent = "Level Complete!";
            text.textContent = "✈️ Part Unlocked!";
            nextBtn.textContent = "Proceed to Next Level";
        }
        
        // Set level-specific reward content
        if (currentLevel > 0 && LEVEL_CONFIG[currentLevel]) {
            const config = LEVEL_CONFIG[currentLevel];
            document.getElementById("rewardTitle").textContent = config.rewardTitle;
            document.getElementById("rewardText").textContent = config.rewardText;
            document.getElementById("nextLevelBtn").textContent = config.nextLevelText;
            
            // LEVELS 1-2: PNG IMAGES ONLY, NO 3D MODELS
            if (currentLevel === 1) {
                // Level 1: Engine PNG ONLY
                document.getElementById('level1RewardImage').style.display = 'block';
                console.log("Level 1: Showing engine.png ONLY - NO 3D models");
            } else if (currentLevel === 2) {
                // Level 2: Cockpit PNG ONLY
                document.getElementById('level2RewardImage').style.display = 'block';
                console.log("Level 2: Showing cockpit.png ONLY - NO 3D models");
            } else if (currentLevel === 3 && config.rewardType === "wings") {
                // Level 3+: 3D models allowed
                document.getElementById('wingCanvas').style.display = 'block';
                showWingAnimation();
            } else if (currentLevel === 4 && config.rewardType === "fuselage") {
                document.getElementById('fuselageCanvas').style.display = 'block';
                showFuselageAnimation();
            } else if (config.rewardType === "landing_gear") {
                showLandingGearAnimation();
            } else if (config.rewardType === "master_pilot") {
                showMasterPilotAnimation();
            }
        }
        
        rewardUnlocked = true;
    }

    // Show reward screen with dark overlay and hidden cube
    function showRewardScreen() {
        // Show dark overlay
        const overlay = document.getElementById("rewardOverlay");
        overlay.style.display = "block";
        
        // Hide the main canvas (Rubik's Cube)
        const mainCanvas = document.getElementById("canvas");
        if (mainCanvas) {
            mainCanvas.style.opacity = "0";
            mainCanvas.style.transition = "opacity 0.5s ease-in-out";
        }
        
        // Darken the background
        document.body.classList.add("reward-mode");
    }

    // Hide reward screen and restore cube
    function hideRewardScreen() {
        // Hide dark overlay
        const overlay = document.getElementById("rewardOverlay");
        overlay.style.display = "none";
        
        // Show the main canvas (Rubik's Cube)
        const mainCanvas = document.getElementById("canvas");
        if (mainCanvas) {
            mainCanvas.style.opacity = "1";
            mainCanvas.style.transition = "opacity 0.5s ease-in-out";
        }
        
        // Restore the background
        document.body.classList.remove("reward-mode");
    }

    // Proceed to next level
    function proceedToNextLevel() {
        console.log("Proceeding to next level...");
        
        // Stop animation
        if (animationId) {
            cancelAnimationFrame(animationId);
        }
        
        // Hide reward screen and restore cube
        hideRewardScreen();
        
        // Hide reward modal
        const rewardModal = document.getElementById("rewardModal");
        rewardModal.style.display = "none";
        
        // Get next level
        const nextLevel = currentLevel + 1;
        
        if (LEVEL_CONFIG[nextLevel]) {
            // Start next level
            startLevel(nextLevel);
        } else {
            // No more levels - show completion message
            alert("🎉 Congratulations! You've completed all available levels!");
            resetState();
        }
    }

    // Override the main scene's add method to prevent 3D models for Levels 1-2
    function prevent3DModelsForLevels1And2() {
        try {
            const mainScene = window.scene || document.querySelector('#canvas')?.__scene;
            if (mainScene && (currentLevel === 1 || currentLevel === 2)) {
                // Store the original add method
                if (!mainScene._originalAdd) {
                    mainScene._originalAdd = mainScene.add.bind(mainScene);
                }
                
                // Override the add method to prevent 3D models
                mainScene.add = function(object) {
                    // Allow essential objects (cube, camera, lights, axes)
                    if (object.type === 'PerspectiveCamera' || 
                        object.type === 'PointLight' || 
                        object.type === 'AmbientLight' || 
                        object.type === 'AxesHelper' ||
                        object.name === 'cube' ||
                        object.name === 'cubelet') {
                        return mainScene._originalAdd(object);
                    }
                    
                    // Block any 3D models for Levels 1-2
                    if (object.name && (
                        object.name.includes('engine') || 
                        object.name.includes('cockpit') || 
                        object.name.includes('wing') || 
                        object.name.includes('fuselage') ||
                        object.name.includes('reward') ||
                        object.name.includes('airplane') ||
                        object.name.includes('aerospace')
                    )) {
                        console.log("BLOCKED 3D model from being added to main scene:", object.name);
                        return;
                    }
                    
                    // Allow other objects
                    return mainScene._originalAdd(object);
                };
                
                console.log("3D model prevention activated for Level", currentLevel);
            }
        } catch (error) {
            console.log("Error preventing 3D models:", error);
        }
    }
    
    // Call this function when starting Levels 1-2
    function startLevel(level) {
        console.log(`Starting Level ${level}...`);
        
        // Reset game state
        resetState();
        currentLevel = level;
        isSolved = false;
        rewardUnlocked = false;
        
        // Prevent 3D models for Levels 1-2
        if (level === 1 || level === 2) {
            prevent3DModelsForLevels1And2();
        }
        
        // Re-enable inputs
        disableAllInputs(false);
        
        // Automatically scramble for the level
        if (level === 1) {
            scrambleCubeLevel1();
        } else if (level === 2) {
            scrambleCubeLevel2();
        } else if (level === 3) {
            scrambleCubeLevel3();
        } else if (level === 4) {
            scrambleCubeLevel4();
        } else if (level === 5) {
            scrambleCubeLevel5();
        }
    }

    // Retry cube (reset and enable inputs)
    function retryCube() {
        closeSuccessModal();
        resetState();
        isSolved = false;
        rewardUnlocked = false;
    }

    // Disable/enable all inputs
    function disableAllInputs(disable) {
        const inputs = [
            "solve-button",
            "undo-button", 
            "scramble-button",
            "level1-button",
            "level2-button",
            "level3-button",
            "level4-button",
            "level5-button",
            "reset-button",
            "done-button",
            "clockwise-icon",
            "counter-clockwise-icon"
        ];
        
        inputs.forEach(id => {
            const element = document.getElementById(id);
            if (element) {
                element.disabled = disable;
            }
        });
    }

    // Apply moves one by one with delay
    async function applyScrambleSequence(sequence) {
        isScrambling = true;
        
        // Disable buttons during scrambling
        document.getElementById("solve-button").disabled = true;
        document.getElementById("undo-button").disabled = true;
        document.getElementById("scramble-button").disabled = true;
        document.getElementById("level1-button").disabled = true;
        document.getElementById("level2-button").disabled = true;
        document.getElementById("level3-button").disabled = true;
        document.getElementById("level4-button").disabled = true;
        document.getElementById("level5-button").disabled = true;
        document.getElementById("reset-button").disabled = true;
        document.getElementById("done-button").disabled = true;
        
        try {
            for (let i = 0; i < sequence.length; i++) {
                const move = sequence[i];
                console.log("Executing move:", move);
                
                // Create and dispatch a keyboard event
                const keyCode = move.charAt(0).charCodeAt();
                const event = new KeyboardEvent('keydown', {
                    key: move.charAt(0),
                    keyCode: keyCode,
                    which: keyCode,
                    bubbles: true
                });
                
                // Trigger the keyboard event
                document.dispatchEvent(event);
                
                // Wait before next move (300ms delay)
                if (i < sequence.length - 1) {
                    await new Promise(resolve => setTimeout(resolve, 300));
                }
            }
        } catch (error) {
            console.error("Error during scrambling:", error);
        } finally {
            isScrambling = false;
            
            // Re-enable buttons
            document.getElementById("solve-button").disabled = false;
            document.getElementById("undo-button").disabled = false;
            document.getElementById("scramble-button").disabled = false;
            document.getElementById("reset-button").disabled = false;
            document.getElementById("done-button").disabled = false;
            // Keep level buttons disabled until solved or reset
        }
    }

    // Level 1 scramble function
    async function scrambleCubeLevel1() {
        console.log("Level 1 scramble function called!");
        
        // Prevent scrambling if already in progress
        if (isScrambling) {
            console.log("Level 1 scrambling blocked: already in progress");
            return;
        }
        
        console.log("Starting Level 1 cube scramble...");
        
        currentLevel = 1;
        isSolved = false;
        rewardUnlocked = false;
        
        // Generate scramble sequence (3 moves)
        const scrambleSequence = generateScrambleSequence(1);
        console.log("Level 1 scramble sequence:", scrambleSequence.join(' '));
        
        // Apply the sequence
        await applyScrambleSequence(scrambleSequence);
        
        console.log("Level 1 cube scramble completed!");
    }

    // Level 2 scramble function
    async function scrambleCubeLevel2() {
        console.log("Level 2 scramble function called!");
        
        // Prevent scrambling if already in progress
        if (isScrambling) {
            console.log("Level 2 scrambling blocked: already in progress");
            return;
        }
        
        console.log("Starting Level 2 cube scramble...");
        
        currentLevel = 2;
        isSolved = false;
        rewardUnlocked = false;
        
        // Generate scramble sequence (4 moves)
        const scrambleSequence = generateScrambleSequence(2);
        console.log("Level 2 scramble sequence:", scrambleSequence.join(' '));
        
        // Apply the sequence
        await applyScrambleSequence(scrambleSequence);
        
        console.log("Level 2 cube scramble completed!");
    }

    // Level 3 scramble function
    async function scrambleCubeLevel3() {
        console.log("Level 3 scramble function called!");
        
        // Prevent scrambling if already in progress
        if (isScrambling) {
            console.log("Level 3 scrambling blocked: already in progress");
            return;
        }
        
        console.log("Starting Level 3 cube scramble...");
        
        currentLevel = 3;
        isSolved = false;
        rewardUnlocked = false;
        
        // Store the solved state for comparison
        solvedState = getCurrentCubeState();
        
        // Generate scramble sequence (5 moves)
        const scrambleSequence = generateScrambleSequence(3);
        console.log("Level 3 scramble sequence:", scrambleSequence.join(' '));
        
        // Apply the sequence
        await applyScrambleSequence(scrambleSequence);
        
        console.log("Level 3 cube scramble completed!");
    }

    // Level 4 scramble function
    async function scrambleCubeLevel4() {
        console.log("Level 4 scramble function called!");
        
        // Prevent scrambling if already in progress
        if (isScrambling) {
            console.log("Level 4 scrambling blocked: already in progress");
            return;
        }
        
        console.log("Starting Level 4 cube scramble...");
        
        currentLevel = 4;
        isSolved = false;
        rewardUnlocked = false;
        
        // Store the solved state for comparison
        solvedStateLevel4 = getCurrentCubeState();
        
        // Generate scramble sequence (7 moves)
        const scrambleSequence = generateScrambleSequence(4);
        console.log("Level 4 scramble sequence:", scrambleSequence.join(' '));
        
        // Apply the sequence
        await applyScrambleSequence(scrambleSequence);
        
        console.log("Level 4 cube scramble completed!");
    }

    // Level 5 scramble function
    async function scrambleCubeLevel5() {
        console.log("Level 5 scramble function called!");
        
        // Prevent scrambling if already in progress
        if (isScrambling) {
            console.log("Level 5 scrambling blocked: already in progress");
            return;
        }
        
        console.log("Starting Level 5 cube scramble...");
        
        currentLevel = 5;
        isSolved = false;
        rewardUnlocked = false;
        
        // Store the solved state for comparison
        solvedStateLevel5 = getCurrentCubeState();
        
        // Generate scramble sequence (10 moves)
        const scrambleSequence = generateScrambleSequence(5);
        console.log("Level 5 scramble sequence:", scrambleSequence.join(' '));
        
        // Apply the sequence
        await applyScrambleSequence(scrambleSequence);
        
        console.log("Level 5 cube scramble completed!");
    }

    // Original scramble function (for regular scrambling)
    async function scrambleCube() {
        console.log("scrambleCube function called!");
        
        // Prevent scrambling if already in progress
        if (isScrambling) {
            console.log("Scrambling blocked: already in progress");
            return;
        }
        
        console.log("Starting cube scramble...");
        
        currentLevel = 0; // Regular scramble, not a level
        
        // Generate scramble sequence (20 moves for regular scramble)
        const sequence = [];
        let lastMove = '';
        let secondLastMove = '';
        
        for (let i = 0; i < 20; i++) {
            let move;
            do {
                move = getRandomMove();
            } while (
                move === lastMove ||
                (move.charAt(0) === lastMove.charAt(0) && move !== lastMove) ||
                (move === lastMove && move === secondLastMove)
            );
            
            sequence.push(move);
            secondLastMove = lastMove;
            lastMove = move;
        }
        
        console.log("Scramble sequence:", sequence.join(' '));
        
        // Apply the sequence
        await applyScrambleSequence(sequence);
        
        console.log("Cube scramble completed!");
    }

    // Helper function to get current cube state
    function getCurrentCubeState() {
        // This function should capture the current state of the cube
        // For now, we'll use a simple approach - in a real implementation,
        // this would interface with the 3D cube object to get the actual state
        return {
            timestamp: Date.now(),
            level: currentLevel,
            // In a full implementation, this would contain the actual cube face states
        };
    }

    // Helper function to compare cube states
    function isCubeSolvedByState(currentState, solvedState) {
        // For Level 5, we'll use the existing solve detection logic
        // In a real implementation, this would compare the actual cube face states
        return checkIfSolvedSimple();
    }

    // Level-specific solve detection for Level 4
    function checkIfSolvedLevel4() {
        const currentState = getCurrentCubeState();
        return isCubeSolvedByState(currentState, solvedStateLevel4);
    }

    // Level-specific solve detection for Level 5
    function checkIfSolvedLevel5() {
        const currentState = getCurrentCubeState();
        return isCubeSolvedByState(currentState, solvedStateLevel5);
    }

    // NEW: Updated Cheat Code Functions
    function activateCheatCode() {
        const cheatInput = document.getElementById('cheat-input');
        const cheatMessage = document.getElementById('cheat-message');
        const enteredCode = cheatInput.value.trim().toUpperCase();
        
        // Clear previous message
        cheatMessage.textContent = '';
        cheatMessage.className = 'cheat-message';
        
        if (!enteredCode) {
            showCheatMessage('Please enter a cheat code!', 'error');
            return;
        }
        
        if (enteredCode === CHEAT_CODE_LEVEL1) {
            if (cheatCodeUsedLevel1) {
                showCheatMessage('Cheat code already used for Level 1!', 'error');
                return;
            }
            
            // Activate Level 1 cheat
            cheatCodeUsedLevel1 = true;
            showCheatMessage('🎉 Cheat code activated! Level 1 completed!', 'success');
            
            // Clear input
            cheatInput.value = '';
            
            // Trigger Level 1 success flow
            setTimeout(() => {
                triggerLevel1Success();
            }, 1500);
            
        } else if (enteredCode === CHEAT_CODE_LEVEL2) {
            if (cheatCodeUsedLevel2) {
                showCheatMessage('Cheat code already used for Level 2!', 'error');
                return;
            }
            
            // Activate Level 2 cheat
            cheatCodeUsedLevel2 = true;
            showCheatMessage('🎉 Cheat code activated! Level 2 completed!', 'success');
            
            // Clear input
            cheatInput.value = '';
            
            // Trigger Level 2 success flow
            setTimeout(() => {
                triggerLevel2Success();
            }, 1500);
            
        } else if (enteredCode === CHEAT_CODE_LEVEL3) {
            if (cheatCodeUsedLevel3) {
                showCheatMessage('Cheat code already used for Level 3!', 'error');
                return;
            }
            
            // Activate Level 3 cheat
            cheatCodeUsedLevel3 = true;
            showCheatMessage('🎉 Cheat code activated! Level 3 completed!', 'success');
            
            // Clear input
            cheatInput.value = '';
            
            // Trigger Level 3 success flow
            setTimeout(() => {
                triggerLevel3Success();
            }, 1500);
            
        } else if (enteredCode === CHEAT_CODE_LEVEL4) {
            if (cheatCodeUsedLevel4) {
                showCheatMessage('Cheat code already used for Level 4!', 'error');
                return;
            }
            
            // Activate Level 4 cheat
            cheatCodeUsedLevel4 = true;
            showCheatMessage('🎉 Cheat code activated! Level 4 completed!', 'success');
            
            // Clear input
            cheatInput.value = '';
            
            // Trigger Level 4 success flow
            setTimeout(() => {
                triggerLevel4Success();
            }, 1500);
            
        } else if (enteredCode === CHEAT_CODE_LEVEL5) {
            if (cheatCodeUsedLevel5) {
                showCheatMessage('Cheat code already used for Level 5!', 'error');
                return;
            }
            
            // Activate Level 5 cheat
            cheatCodeUsedLevel5 = true;
            showCheatMessage('🎉 Cheat code activated! Level 5 completed!', 'success');
            
            // Clear input
            cheatInput.value = '';
            
            // Trigger Level 5 success flow
            setTimeout(() => {
                triggerLevel5Success();
            }, 1500);
            
        } else {
            showCheatMessage('❌ Invalid cheat code!', 'error');
        }
    }
    
    function showCheatMessage(message, type) {
        const cheatMessage = document.getElementById('cheat-message');
        cheatMessage.textContent = message;
        cheatMessage.className = `cheat-message ${type}`;
        
        // Auto-clear success messages after 3 seconds
        if (type === 'success') {
            setTimeout(() => {
                cheatMessage.textContent = '';
                cheatMessage.className = 'cheat-message';
            }, 3000);
        }
    }
    
    function triggerLevel1Success() {
        // Set current level to 1
        currentLevel = 1;
        
        // Show success modal
        const successModal = document.getElementById('successModal');
        const successTitle = document.getElementById('successTitle');
        const successMessage = document.getElementById('successMessage');
        
        successTitle.textContent = '🎉 Congratulations!';
        successMessage.textContent = 'You\'ve successfully completed Level 1 using the cheat code!';
        
        successModal.style.display = 'flex';
        
        // Disable Level 1 button since it's completed
        const level1Button = document.getElementById('level1-button');
        if (level1Button) {
            level1Button.disabled = true;
            level1Button.textContent = 'Level 1 - Completed ✓';
        }
    }
    
    function triggerLevel2Success() {
        // Set current level to 2
        currentLevel = 2;
        
        // Show success modal
        const successModal = document.getElementById('successModal');
        const successTitle = document.getElementById('successTitle');
        const successMessage = document.getElementById('successMessage');
        
        successTitle.textContent = '🎉 Congratulations!';
        successMessage.textContent = 'You\'ve successfully completed Level 2 using the cheat code!';
        
        successModal.style.display = 'flex';
        
        // Disable Level 2 button since it's completed
        const level2Button = document.getElementById('level2-button');
        if (level2Button) {
            level2Button.disabled = true;
            level2Button.textContent = 'Level 2 - Completed ✓';
        }
    }
    
    function triggerLevel3Success() {
        // Set current level to 3
        currentLevel = 3;
        
        // Show success modal
        const successModal = document.getElementById('successModal');
        const successTitle = document.getElementById('successTitle');
        const successMessage = document.getElementById('successMessage');
        
        successTitle.textContent = '🎉 Congratulations!';
        successMessage.textContent = 'You\'ve successfully completed Level 3 using the cheat code!';
        
        successModal.style.display = 'flex';
        
        // Disable Level 3 button since it's completed
        const level3Button = document.getElementById('level3-button');
        if (level3Button) {
            level3Button.disabled = true;
            level3Button.textContent = 'Level 3 - Completed ✓';
        }
    }
    
    function triggerLevel4Success() {
        // Set current level to 4
        currentLevel = 4;
        
        // Show success modal
        const successModal = document.getElementById('successModal');
        const successTitle = document.getElementById('successTitle');
        const successMessage = document.getElementById('successMessage');
        
        successTitle.textContent = '🎉 Congratulations!';
        successMessage.textContent = 'You\'ve successfully completed Level 4 using the cheat code!';
        
        successModal.style.display = 'flex';
        
        // Disable Level 4 button since it's completed
        const level4Button = document.getElementById('level4-button');
        if (level4Button) {
            level4Button.disabled = true;
            level4Button.textContent = 'Level 4 - Completed ✓';
        }
    }
    
    function triggerLevel5Success() {
        // Set current level to 5
        currentLevel = 5;
        
        // Show success modal
        const successModal = document.getElementById('successModal');
        const successTitle = document.getElementById('successTitle');
        const successMessage = document.getElementById('successMessage');
        
        successTitle.textContent = '🎉 Congratulations!';
        successMessage.textContent = 'You\'ve successfully completed Level 5 using the cheat code!';
        
        successModal.style.display = 'flex';
        
        // Disable Level 5 button since it's completed
        const level5Button = document.getElementById('level5-button');
        if (level5Button) {
            level5Button.disabled = true;
            level5Button.textContent = 'Level 5 - Completed ✓';
        }
    }
    
    // Add Enter key support for cheat input
    document.addEventListener('DOMContentLoaded', function() {
        const cheatInput = document.getElementById('cheat-input');
        if (cheatInput) {
            cheatInput.addEventListener('keypress', function(event) {
                if (event.key === 'Enter') {
                    activateCheatCode();
                }
            });
        }
    });

    // Make functions available globally
    window.scrambleCube = scrambleCube;
    window.scrambleCubeLevel1 = scrambleCubeLevel1;
    window.scrambleCubeLevel2 = scrambleCubeLevel2;
    window.scrambleCubeLevel3 = scrambleCubeLevel3;
    window.scrambleCubeLevel4 = scrambleCubeLevel4;
    window.scrambleCubeLevel5 = scrambleCubeLevel5;
    window.checkIfSolved = checkIfSolved;
    window.collectReward = collectReward;
    window.proceedToNextLevel = proceedToNextLevel;
    window.closeSuccessModal = closeSuccessModal;
    window.closeFailureModal = closeFailureModal;
    window.retryCube = retryCube;
    
    // Debug: Check if functions are available
    console.log("Solve detection and reward functions loaded:");
    console.log("- window.checkIfSolved:", typeof window.checkIfSolved);
    console.log("- window.collectReward:", typeof window.collectReward);
    console.log("- window.proceedToNextLevel:", typeof window.proceedToNextLevel);
    console.log("- window.scrambleCubeLevel1:", typeof window.scrambleCubeLevel1);
    console.log("- window.scrambleCubeLevel2:", typeof window.scrambleCubeLevel2);
    console.log("- window.scrambleCubeLevel3:", typeof window.scrambleCubeLevel3);
    console.log("- window.scrambleCubeLevel4:", typeof window.scrambleCubeLevel4);
    console.log("- window.scrambleCubeLevel5:", typeof window.scrambleCubeLevel5);

    // COMPLETELY OVERRIDE 3D ANIMATION FUNCTIONS FOR LEVELS 1-2
    // These functions will do NOTHING for Levels 1-2, preventing any 3D models from showing
    
    function initEngineAnimation() {
        // DISABLED for Levels 1-2 - use PNG images instead
        if (currentLevel === 1 || currentLevel === 2) {
            console.log("3D Engine animation DISABLED for Level", currentLevel, "- using PNG image instead");
            return;
        }
        // Only allow 3D engine for Level 3+
        console.log("Initializing 3D engine animation for Level", currentLevel);
    }
    
    function initCockpitAnimation() {
        // DISABLED for Levels 1-2 - use PNG images instead
        if (currentLevel === 1 || currentLevel === 2) {
            console.log("3D Cockpit animation DISABLED for Level", currentLevel, "- using PNG image instead");
            return;
        }
        // Only allow 3D cockpit for Level 3+
        console.log("Initializing 3D cockpit animation for Level", currentLevel);
    }
    
    function showEngineAnimation() {
        // DISABLED for Levels 1-2 - use PNG images instead
        if (currentLevel === 1 || currentLevel === 2) {
            console.log("3D Engine animation DISABLED for Level", currentLevel, "- using PNG image instead");
            return;
        }
        // Only allow 3D engine for Level 3+
        console.log("Showing 3D engine animation for Level", currentLevel);
    }
    
    function showCockpitAnimation() {
        // DISABLED for Levels 1-2 - use PNG images instead
        if (currentLevel === 1 || currentLevel === 2) {
            console.log("3D Cockpit animation DISABLED for Level", currentLevel, "- using PNG image instead");
            return;
        }
        // Only allow 3D cockpit for Level 3+
        console.log("Showing 3D cockpit animation for Level", currentLevel);
    }
    
    function showWingAnimation() {
        // Only for Level 3+
        if (currentLevel < 3) {
            console.log("3D Wing animation DISABLED for Level", currentLevel);
            return;
        }
        console.log("Showing 3D wing animation for Level", currentLevel);
    }
    
    function showFuselageAnimation() {
        // Only for Level 4+
        if (currentLevel < 4) {
            console.log("3D Fuselage animation DISABLED for Level", currentLevel);
            return;
        }
        console.log("Showing 3D fuselage animation for Level", currentLevel);
    }
    
    function showLandingGearAnimation() {
        // Only for higher levels
        if (currentLevel < 5) {
            console.log("3D Landing gear animation DISABLED for Level", currentLevel);
            return;
        }
        console.log("Showing 3D landing gear animation for Level", currentLevel);
    }
    
    function showMasterPilotAnimation() {
        // Only for Level 5+
        if (currentLevel < 5) {
            console.log("3D Master pilot animation DISABLED for Level", currentLevel);
            return;
        }
        console.log("Showing 3D master pilot animation for Level", currentLevel);
    }
    </script>
  </body>
</html>
